# Preprocesamiento: Occupation
DROP TABLE IF EXISTS Z_OCCUPATION_RAW;
CREATE TABLE Z_OCCUPATION_RAW (PRIMARY KEY(DONOR_ID)) AS
SELECT
	A.ID AS DONOR_ID,
	OCCUPATION,
	CASE WHEN B.DELETED_AT IS NOT NULL THEN 1 ELSE 0 END AS CHURN
FROM
	Z_PREPROCESS_DONOR A
LEFT JOIN
	DONATIONS B
ON A.ID = B.DONOR_ID
WHERE
	OCCUPATION IS NOT NULL 
	AND TRIM(OCCUPATION) <> '' 
	AND TRIM(OCCUPATION) NOT LIKE '%xxxx%'
	AND TRIM(OCCUPATION) <> '-'
	AND TRIM(OCCUPATION) <> '0'
	AND A.ID NOT IN (93,52,68,69,70,71,13288); -- DONORS CON MAS DE UNA DONACION, PINCHA EL PRIMARY KEY
	
SELECT
	COUNT(*)
FROM
	Z_OCCUPATION_RAW;

# Creo tabla para importar resultados
DROP TABLE IF EXISTS Z_OCCUPATION_NORMALIZED;
CREATE TABLE Z_OCCUPATION_NORMALIZED
(
DONOR_ID BIGINT,
OCCUPATION VARCHAR(60),
CHURN INT,
OCCUPATION_NORMALIZED VARCHAR(60)
);

